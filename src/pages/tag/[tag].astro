---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getAllTags, getPostsByTag, sortPostsByDate } from '../../utils';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const allTags = getAllTags(allPosts);

  return allTags.map((tag) => ({
    params: { tag: tag.toLowerCase() },
    props: { tag },
  }));
}

const { tag } = Astro.props;

// Get all posts and filter by tag
const allPosts = await getCollection('posts');
const tagPosts = sortPostsByDate(getPostsByTag(allPosts, tag));

const title = `Artículos etiquetados con "${tag}"`;
const description = `Todos los artículos del blog etiquetados con ${tag}`;
---

<BlogLayout title={title} description={description}>
  <div class="px-2">
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-4">
        Artículos etiquetados con "{tag}"
      </h1>
      <p class="text-lg text-base-content/70">
        {tagPosts.length} {tagPosts.length === 1 ? 'artículo encontrado' : 'artículos encontrados'}
      </p>
    </div>

    {tagPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {tagPosts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-xl text-base-content/60 mb-4">
          No se encontraron artículos con esta etiqueta.
        </p>
        <a href="/tag" class="btn btn-primary">
          Ver todas las etiquetas
        </a>
      </div>
    )}

    <div class="mt-12 text-center">
      <a href="/tag" class="btn btn-outline">
        ← Ver todas las etiquetas
      </a>
    </div>
  </div>
</BlogLayout>