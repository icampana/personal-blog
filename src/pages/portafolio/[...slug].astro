---
import { type CollectionEntry, getCollection } from 'astro:content';
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import { getProjectUrl } from '../../utils/client';
import {
  getLanguageFromFilename,
  LOCALES,
} from '../../utils/i18n';

export async function getStaticPaths() {
  const projects = await getCollection('projects');

  // Filter only Spanish projects (exclude .en.md and .pt.md)
  const spanishProjects = projects.filter(
    (project) => getLanguageFromFilename(project.id) === LOCALES.DEFAULT || getLanguageFromFilename(project.id) === null,
  );

  return spanishProjects.map((project) => {
    const url = getProjectUrl(project);
    // Remove the /portafolio prefix and split into slug parts
    const slugParts = url
      .replace('/portafolio/', '')
      .split('/')
      .filter(Boolean);

    return {
      params: { slug: slugParts.join('/') },
      props: { project },
    };
  });
}

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
---

<ProjectLayout project={project} />

<style>
  @reference "../../styles/globals.css";

  .prose {
    @apply text-base-content;
  }

  .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
    @apply text-base-content;
  }

  .prose code {
    @apply bg-base-200 text-base-content px-1 py-0.5 rounded;
  }

  .prose pre {
    @apply bg-base-200 text-base-content;
  }

  .prose blockquote {
    @apply border-l-primary text-base-content;
  }
</style>
