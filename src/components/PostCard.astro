---
import type { CollectionEntry } from 'astro:content';
import { formatDate, getPostUrl } from '../utils/client';
import { getReadingTime } from '../utils';
import { normalizeImagePath } from '../utils/imageUtils';
import { generateImgxUrl } from '../utils/imgxUtils';
import { Image } from 'astro:assets';

export interface Props {
  post: CollectionEntry<'posts'>;
  lazyLoad?: boolean;
}

const { post, lazyLoad = true } = Astro.props;
const { title, description, featuredImage, tags, date } = post.data;

const readingTime = getReadingTime(post.body);
const readingTimeText = `${Math.round(readingTime.minutes)} minutos`;

const imagePath = normalizeImagePath(featuredImage);

const postUrl = getPostUrl(post);
const summary = description || post.body.slice(0, 200) + '...';
---

  <div
    class='dashboard-panel flex flex-col rounded-xl overflow-hidden hover:scale-[1.02] transition-transform duration-300 border border-[var(--border-panel)] bg-[var(--bg-panel)]'>
  <figure>
    <a href={postUrl} class='block' aria-label={`Leer el post: ${title}`}>
      <Image
        src={imagePath.startsWith('http') || imagePath.startsWith('//')
          ? imagePath
          : generateImgxUrl(imagePath, 400, 225)}
        alt={title}
        class='w-full object-cover'
        loading={lazyLoad ? 'lazy' : 'eager'}
        width='400'
        height='225'
      />
    </a>
  </figure>
    <div class='p-6 flex flex-col flex-1'>
      <h2
        class='mono text-lg font-bold text-base-content mb-2 hover:text-[var(--accent-neon)] transition-colors'>
        <a href={postUrl} class='hover:text-[var(--accent-neon)] transition-colors'>
          {title}
        </a>
      </h2>
      <p class='text-base-content/70 text-sm leading-relaxed mb-4'>
        {summary}
      </p>

      {
        tags && tags.length > 0 && (
          <div class='flex flex-wrap gap-2 mb-4'>
            {tags.map((tag) => (
              <a
                href={`/tag/${tag.toLowerCase()}`}
                class='px-2 py-1 bg-base-200 text-base-content mono text-xs border border-base-content/20 rounded hover:border-[var(--accent-neon)] hover:text-[var(--accent-neon)] transition-colors'>
                {tag}
              </a>
            ))}
          </div>
        )
      }

      <div class='flex justify-between items-center text-xs text-base-content/50 mt-auto'>
        <time datetime={date.toISOString()} class='capitalize'>
          {formatDate(date)}
        </time>
        <div>
          <em>Lectura:</em> {readingTimeText}
        </div>
      </div>
    </div>
</div>
</div>
