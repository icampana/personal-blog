---
import type { CollectionEntry } from 'astro:content';
import { getProjectUrl } from '../utils/client';
import { normalizeImagePath } from '../utils/imageUtils';
import { generateImgxUrl } from '../utils/imgxUtils';

export interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, description, galleryImage, techStack, liveUrl, repoUrl } =
  project.data;

const projectUrl = getProjectUrl(project);
const imagePath = normalizeImagePath(galleryImage?.[0]);
---

<div
  class='dashboard-panel rounded-xl overflow-hidden hover:scale-[1.02] transition-transform duration-300 border border-[var(--border-panel)] bg-[var(--bg-panel)]'>
  <a href={projectUrl} class='block'>
    <figure>
      <img
        alt={title}
        src={imagePath.startsWith('http') || imagePath.startsWith('//')
          ? imagePath
          : generateImgxUrl(imagePath, 400, 225)}
        class='w-full object-cover'
        loading='lazy'
        width='400'
        height='225'
      />
    </figure>
    <div class='p-6'>
      <h2
        class='mono text-lg font-bold text-zinc-100 mb-2 hover:text-[var(--accent-neon)] transition-colors'>
        {title}
      </h2>
      <p class='text-zinc-400 text-sm leading-relaxed mb-4'>
        {description}
      </p>

      {
        techStack && techStack.length > 0 && (
          <div class='flex flex-wrap gap-2 mb-4'>
            {techStack.map((tech) => (
              <span class='px-2 py-1 bg-zinc-800 text-zinc-300 mono text-xs border border-zinc-700 rounded'>
                {tech}
              </span>
            ))}
          </div>
        )
      }

      <div class='flex gap-3'>
        {
          liveUrl && (
            <a
              href={liveUrl}
              class='mono text-xs font-bold bg-[var(--accent-neon)] text-black hover:opacity-90 px-4 py-2 rounded transition-opacity flex items-center'
              target='_blank'
              rel='noopener noreferrer'>
              VER PROYECTO
            </a>
          )
        }

        {
          repoUrl && (
            <a
              href={repoUrl}
              class='mono text-xs font-bold bg-zinc-800 text-zinc-300 border border-zinc-700 hover:border-[var(--accent-neon)] hover:text-[var(--accent-neon)] px-4 py-2 rounded transition-all flex items-center'
              target='_blank'
              rel='noopener noreferrer'>
              <span class='material-symbols-outlined text-sm mr-1'>code</span>
              VER CÃ“DIGO
            </a>
          )
        }
      </div>
    </div>
  </a>
</div>
