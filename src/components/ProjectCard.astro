---
import type { CollectionEntry } from 'astro:content';
import type { Locale } from '../utils/i18n';
import { getProjectUrl } from '../utils/client';
import { normalizeImagePath } from '../utils/imageUtils';
import { generateImgxUrl } from '../utils/imgxUtils';
import { Image } from 'astro:assets';

export interface Props {
  project: CollectionEntry<'projects'>;
  locale?: Locale;
}

const { project, locale } = Astro.props;
const { title, description, galleryImage, techStack, liveUrl, repoUrl } =
  project.data;

const projectUrl = getProjectUrl(project, locale);
const imagePath = normalizeImagePath(galleryImage?.[0]);
---

  <div
    class='dashboard-panel flex flex-col rounded-xl overflow-hidden hover:scale-[1.02] transition-transform duration-300 border border-[var(--border-panel)] bg-[var(--bg-panel)]'>
  <figure>
    <a href={projectUrl} class='block'>
      <Image
        src={imagePath.startsWith('http') || imagePath.startsWith('//')
          ? imagePath
          : generateImgxUrl(imagePath, 400, 225)}
        alt={title}
        class='w-full object-cover'
        loading='lazy'
        width='400'
        height='225'
      />
    </a>
  </figure>
    <div class='p-6 flex flex-col flex-1'>
      <h2
        class='mono text-lg font-bold text-base-content mb-2 hover:text-[var(--accent-neon)] transition-colors'>
        <a href={projectUrl} class='hover:text-[var(--accent-neon)] transition-colors'>
          {title}
        </a>
      </h2>
      <p class='text-base-content/70 text-sm leading-relaxed mb-4'>
        {description}
      </p>

      {
        techStack && techStack.length > 0 && (
          <div class='flex flex-wrap gap-2 mb-4'>
            {techStack.map((tech) => (
              <span class='px-2 py-1 bg-base-200 text-base-content mono text-xs border border-base-content/20 rounded'>
                {tech}
              </span>
            ))}
          </div>
        )
      }

      <div class='flex gap-3 mt-auto'>
        {
          liveUrl && (
            <a
              href={liveUrl}
              class='mono text-xs font-bold bg-[var(--accent-neon)] text-black hover:opacity-90 px-4 py-2 rounded transition-opacity flex items-center'
              target='_blank'
              rel='noopener noreferrer'>
              VER PROYECTO
            </a>
          )
        }

        {
          repoUrl && (
            <a
              href={repoUrl}
              class='mono text-xs font-bold bg-base-200 text-base-content border border-base-content/20 hover:border-[var(--accent-neon)] hover:text-[var(--accent-neon)] px-4 py-2 rounded transition-all flex items-center'
              target='_blank'
              rel='noopener noreferrer'>
              <span class='material-symbols-outlined text-sm mr-1'>code</span>
              VER CÃ“DIGO
            </a>
          )
        }
      </div>
    </div>
  </div>
